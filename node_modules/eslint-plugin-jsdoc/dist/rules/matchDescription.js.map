{"version":3,"sources":["../../src/rules/matchDescription.js"],"names":["matchDescriptionDefault","stringOrDefault","value","userDefault","jsdoc","report","context","utils","options","validateDescription","description","tag","mainDescription","tagValue","tagName","tags","regex","getRegexFromString","matchDescription","test","line","source","number","getDescription","replace","Object","keys","length","hasOptionTag","Boolean","forEachPreferredTag","matchingJsdocTag","targetTagName","name","getTagDescription","trim","whitelistedTags","filterTags","tagsWithNames","tagsWithoutNames","getTagsByType","some","contextDefaults","meta","docs","url","schema","additionalProperties","properties","contexts","items","anyOf","type","comment","oneOf","format","patternProperties","enum"],"mappings":"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","sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n// If supporting Node >= 10, we could loosen the default to this for the\n//   initial letter: \\\\p{Upper}\nconst matchDescriptionDefault = '^[A-Z`\\\\d_][\\\\s\\\\S]*[.?!`]$';\n\nconst stringOrDefault = (value, userDefault) => {\n  return typeof value === 'string' ?\n    value :\n    userDefault || matchDescriptionDefault;\n};\n\nexport default iterateJsdoc(({\n  jsdoc,\n  report,\n  context,\n  utils,\n}) => {\n  const options = context.options[0] || {};\n\n  const validateDescription = (description, tag) => {\n    if (!tag && options.mainDescription === false) {\n      return;\n    }\n\n    let tagValue = options.mainDescription;\n    if (tag) {\n      const tagName = tag.tag;\n      tagValue = options.tags[tagName];\n    }\n\n    const regex = utils.getRegexFromString(\n      stringOrDefault(tagValue, options.matchDescription),\n    );\n\n    if (!regex.test(description)) {\n      report('JSDoc description does not satisfy the regex pattern.', null, tag || {\n        // Add one as description would typically be into block\n        line: jsdoc.source[0].number + 1,\n      });\n    }\n  };\n\n  if (jsdoc.description) {\n    const {description} = utils.getDescription();\n    validateDescription(\n      description.replace(/\\s+$/, ''),\n    );\n  }\n\n  if (!options.tags || !Object.keys(options.tags).length) {\n    return;\n  }\n\n  const hasOptionTag = (tagName) => {\n    return Boolean(options.tags[tagName]);\n  };\n\n  utils.forEachPreferredTag('description', (matchingJsdocTag, targetTagName) => {\n    const description = (matchingJsdocTag.name + ' ' + utils.getTagDescription(matchingJsdocTag)).trim();\n    if (hasOptionTag(targetTagName)) {\n      validateDescription(description, matchingJsdocTag);\n    }\n  }, true);\n\n  const whitelistedTags = utils.filterTags(({tag: tagName}) => {\n    return hasOptionTag(tagName);\n  });\n  const {tagsWithNames, tagsWithoutNames} = utils.getTagsByType(whitelistedTags);\n\n  tagsWithNames.some((tag) => {\n    const description = utils.getTagDescription(tag).replace(/^[- ]*/u, '').trim();\n\n    return validateDescription(description, tag);\n  });\n\n  tagsWithoutNames.some((tag) => {\n    const description = (tag.name + ' ' + utils.getTagDescription(tag)).trim();\n\n    return validateDescription(description, tag);\n  });\n}, {\n  contextDefaults: true,\n  meta: {\n    docs: {\n      description: 'Enforces a regular expression pattern on descriptions.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-match-description',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n          mainDescription: {\n            oneOf: [\n              {\n                format: 'regex',\n                type: 'string',\n              },\n              {\n                type: 'boolean',\n              },\n            ],\n          },\n          matchDescription: {\n            format: 'regex',\n            type: 'string',\n          },\n          tags: {\n            patternProperties: {\n              '.*': {\n                oneOf: [\n                  {\n                    format: 'regex',\n                    type: 'string',\n                  },\n                  {\n                    enum: [true],\n                    type: 'boolean',\n                  },\n                ],\n              },\n            },\n            type: 'object',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"file":"matchDescription.js"}